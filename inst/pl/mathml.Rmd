---
title: "MathML via Prolog"
author: "Matthias Gondan"
date: "7 7 2021"
output: html_document
---

```{r}
library(rolog)
consult(system.file("pl/mathml.pl"), package="rolog"))

mathml = function(term)
{
  t = once(call("r_mathml", term, expression(X)))
  cat(sapply(t$X, as.character), sep="")
}
```

# Binomial probability

```{r, results="asis"}
term = quote(pbinom(k, N, p))

# Pretty-print as MathML
mathml(term)

k <- 10
N <- 14
p <- 0.4

# Calculate result
eval(term)
```

# An integral

This is a bit more tricky, because Prolog needs to call back R to obtain the 
name of the integration variable. The _Rolog_ package provides a Prolog
predicate r_eval/2 for this purpose. Here, it is used for something like
r_eval(formalArgs(args(sin)), X) (see mathml.pl), which unifies X with $x$.

```{r, results='asis'}
term = quote(integrate(sin, 0L, 2L*pi))
mathml(term)
eval(term)
```

Note that at the prolog end (see mathml.pl distributed in this folder), 
integrate/3 is rather rigid, it accepts only these three arguments in that 
particular order, and without names, that is, 
integrate(sin, lower=0L, upper=2L * pi) would not print the desired result. 

# A self-written function

```{r, results='asis'}
f = function(u)
{
  sin(u)
}

term = quote(integrate(f, -Inf, Inf))
mathml(term)

# It's a bit of a mystery that R knows the result of this integral.
eval(term)
```
